{% extends "base.html" %}
{% block title %}Admin Panel{% endblock %}
{% block body_class %}admin-manage-body{% endblock %}

{% block content %}
<div class="admin-panel-container">
    <h1>Admin Management Panel</h1>
    <div class="admin-header-actions">
        <a href="{{ url_for('admin_logout') }}" class="btn btn-secondary">Logout</a>
        <a href="/" class="btn btn-secondary">Home</a>
    </div>

    <div class="admin-stats">
        <div class="stat-box">
            <div class="stat-value">{{ total_prize_pool | int | format_currency }}</div>
            <div class="stat-label">Remaining Prize Pool</div>
        </div>
        <div class="stat-box">
            <div class="stat-value">{{ total_prizes }}</div>
            <div class="stat-label">Total Remaining Prizes</div>
        </div>
    </div>

    <div class="admin-section">
        <h2>Users Management</h2>
        <div class="form-actions">
            <form method="POST" action="{{ url_for('admin_add_user') }}" class="inline-form">
                <input type="text" name="name" placeholder="New Player Name" required>
                <button type="submit" class="btn btn-primary">Add Player</button>
            </form>
            <a href="{{ url_for('admin_reset') }}" class="btn btn-warning" onclick="return confirm('Are you sure you want to reset all user spins and delete winners?')">Reset Spins/Winners</a>
        </div>
        
        <table class="admin-table">
            <thead>
                <tr><th>ID</th><th>Name</th><th>Used</th><th>Action</th></tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.name }}</td>
                    <td>{% if user.used %}YES{% else %}NO{% endif %}</td>
                    <td><a href="{{ url_for('admin_delete_user', id=user.id) }}" onclick="return confirm('Delete user {{ user.name }}?')" class="btn-delete">Delete</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="admin-section">
        <h2>Prize Management</h2>
        <form method="POST" action="{{ url_for('admin_add_prize') }}" class="inline-form">
            <input type="number" name="amount" placeholder="Amount ($)" required min="100">
            <input type="number" name="quantity" placeholder="Quantity" required min="1">
            <button type="submit" class="btn btn-primary">Add Prize Type</button>
        </form>

        <table class="admin-table">
            <thead>
                <tr><th>ID</th><th>Amount</th><th>Quantity</th><th>Action</th></tr>
            </thead>
            <tbody>
                {% for prize in prizes %}
                <tr>
                    <td>{{ prize.id }}</td>
                    <td>${{ prize.amount | int | format_currency }}</td>
                    <td>{{ prize.quantity }}</td>
                    <td><a href="{{ url_for('admin_delete_prize', id=prize.id) }}" onclick="return confirm('Delete prize type ${{ prize.amount | int | format_currency }}?')" class="btn-delete">Delete</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="admin-section">
        <h2>Change Admin Password</h2>
        <form method="POST" action="{{ url_for('admin_change_password') }}" class="inline-form">
            <input type="password" name="password" placeholder="New Admin Password" required>
            <button type="submit" class="btn btn-primary">Change Password</button>
        </form>
    </div>

    <div class="admin-section">
        <div class="form-actions" style="margin-bottom: 5px;">
            <h2>Recent Winners</h2>
            <a href="{{ url_for('export_winners_csv') }}" class="btn btn-secondary">Export Winners to CSV</a>
        </div>
        <table class="admin-table">
            <thead>
                <tr><th>Name</th><th>Prize</th><th>Date</th></tr>
            </thead>
            <tbody>
                {% for winner in winners %}
                <tr>
                    <td>{{ winner.name }}</td>
                    <td>${{ winner.prize | int | format_currency }}</td>
                    <td>{{ winner.date }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
